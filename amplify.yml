version: 1
applications:
  - appRoot: .
    frontend:
      phases:
        preBuild:
          commands:
            - echo "Installing Node.js 20.18.0..."
            - nvm install 20.18.0
            - nvm use 20.18.0
            - echo "Node.js version:"
            - node --version
            - echo "Installing dependencies..."
            - npm ci
        build:
          commands:
            - echo "Building Next.js app..."
            - npm run build
      artifacts:
        # .next contains the SSR build output
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*
    # Environment variables for SSR functions
    # These will be available to API routes at runtime
    environment:
      variables:
        FIO_API_ENDPOINT: ${FIO_API_ENDPOINT}
        FIO_CHAIN_ID: ${FIO_CHAIN_ID}
        FIO_SYSTEM_PUBLIC_KEY: ${FIO_SYSTEM_PUBLIC_KEY}
        FIO_MOCK_MODE: ${FIO_MOCK_MODE}
        NEXT_PUBLIC_FIO_NETWORK: ${NEXT_PUBLIC_FIO_NETWORK}
        SUPABASE_URL: ${SUPABASE_URL}
      secrets:
        FIO_SYSTEM_PRIVATE_KEY: ${FIO_SYSTEM_PRIVATE_KEY}
        SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
    