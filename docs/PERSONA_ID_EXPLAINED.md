# Persona ID vs FIO Handle - Identity Architecture

## Quick Answer

**Root DID** = Master identity (ONE per user)  
**Persona ID** = Context-specific identity (MANY per user)  
**FIO Handle** = Blockchain identity (e.g., `test21@knyt`)  
**FIO Public Key** = Blockchain address (e.g., `FIO7Jpu6...`)

---

## Identity Hierarchy

```
User (Human/AI Entity)
  └─ Root DID (did:qube:root-xyz...)  ← ONE per user
      ├─ Persona 1 (did:qube:persona-abc...)  ← Multiple personas
      │   ├─ FIO Handle: alice@aigent
      │   ├─ Reputation in Context A
      │   └─ Cohort memberships
      │
      ├─ Persona 2 (did:qube:persona-def...)
      │   ├─ FIO Handle: alice-work@aigent
      │   ├─ Reputation in Context B
      │   └─ Different cohort memberships
      │
      └─ Persona 3 (did:qube:persona-ghi...)
          ├─ Anonymous (no FIO handle)
          ├─ Separate reputation
          └─ Different cohorts
```

**Key Principle:** Each user has ONE Root DID, but MANY personas for different contexts.

---

## The Identity Layers

### 1. Persona ID (System/Database Layer)

```typescript
id: "550e8400-e29b-41d4-a716-446655440000"  // UUID v4
```

**What it is:**
- PostgreSQL UUID (Universally Unique Identifier)
- Generated by Supabase when persona is created
- Primary key in `persona` table
- **NOT** on the blockchain
- **NOT** searchable on FIO explorer

**Purpose:**
- Internal database reference
- Links persona to other system entities (reputation, transactions, etc.)
- Used in API calls and frontend state
- Enables one user to have multiple personas

**From DIDQube Perspective:**
- This is the **local identifier** for the persona entity
- Part of the application's internal identity graph
- Can be thought of as a "session" or "profile" within the app

---

### 2. FIO Handle (Blockchain Layer)

```typescript
fio_handle: "test21@knyt"
```

**What it is:**
- Human-readable blockchain identity
- Registered on FIO Protocol blockchain
- Format: `username@domain`
- **Searchable on FIO explorer**: https://fio-test.bloks.io/

**Purpose:**
- User-facing identity
- Portable across applications
- Can receive crypto payments
- Can be used for authentication

**From DIDQube Perspective:**
- This is the **public identifier** for the persona
- Decentralized Identifier (DID) equivalent
- Verifiable on blockchain
- Part of the user's sovereign identity

---

### 3. FIO Public Key (Cryptographic Layer)

```typescript
fio_public_key: "FIO7Jpu6RnKt6URTaQfXfdzZBFtoXdbXuQMiVPVyrM913ES6wzFvo"
```

**What it is:**
- Cryptographic public key (EOSIO format)
- Derived from private key
- Owner address on FIO blockchain
- **Searchable on FIO explorer**

**Purpose:**
- Proves ownership of FIO handle
- Receives blockchain transactions
- Signs blockchain operations
- Controls the FIO handle

**From DIDQube Perspective:**
- This is the **cryptographic proof** of identity
- Public key in a DID Document
- Enables verifiable credentials
- Foundation of self-sovereign identity

---

## How They're Related

```
┌─────────────────────────────────────────────────────────┐
│                    User's Identity                       │
└─────────────────────────────────────────────────────────┘
                            │
                            ├─── System Layer (Database)
                            │    └─ Persona ID: "550e8400-..."
                            │       ├─ Internal reference
                            │       ├─ Links to reputation
                            │       └─ Links to transactions
                            │
                            ├─── Blockchain Layer (FIO Protocol)
                            │    └─ FIO Handle: "test21@knyt"
                            │       ├─ Human-readable
                            │       ├─ Publicly verifiable
                            │       └─ Owned by FIO Public Key
                            │
                            └─── Cryptographic Layer
                                 └─ FIO Public Key: "FIO7Jpu6..."
                                    ├─ Proves ownership
                                    ├─ Controls handle
                                    └─ Paired with Private Key
```

---

## Database Schema

```typescript
interface Persona {
  // System identifiers
  id: string;                    // UUID - System ID (NOT on blockchain)
  root_id: string | null;        // Parent persona (for hierarchies)
  
  // FIO blockchain identifiers
  fio_handle: string | null;     // e.g., "test21@knyt"
  fio_public_key: string | null; // e.g., "FIO7Jpu6..."
  fio_tx_id: string | null;      // Blockchain transaction ID
  
  // Identity settings
  default_identity_state: string; // Privacy level
  world_id_status: string;        // Human/AI verification
  
  // Metadata
  app_origin: string | null;      // Which app created this
  created_at: string;             // Timestamp
}
```

---

## Why Can't You Find Persona ID on FIO Explorer?

**Because it's not supposed to be there!**

The Persona ID is:
- ✅ In your PostgreSQL database
- ✅ In your application's API responses
- ✅ Used in your frontend state
- ❌ NOT on the FIO blockchain
- ❌ NOT in FIO explorer

**What you CAN find on FIO explorer:**
1. **FIO Handle**: Search for `test21@knyt`
2. **FIO Public Key**: Search for `FIO7Jpu6...`
3. **Transaction ID**: Search for the `fio_tx_id` (if not `fallback_tx_*`)

---

## From a DIDQube Perspective

### DID Document Mapping

```json
{
  "@context": "https://www.w3.org/ns/did/v1",
  "id": "did:qube:550e8400-e29b-41d4-a716-446655440000",
  "alsoKnownAs": [
    "did:fio:test21@knyt"
  ],
  "verificationMethod": [{
    "id": "did:qube:550e8400...#keys-1",
    "type": "EcdsaSecp256k1VerificationKey2019",
    "controller": "did:qube:550e8400...",
    "publicKeyBase58": "FIO7Jpu6RnKt6URTaQfXfdzZBFtoXdbXuQMiVPVyrM913ES6wzFvo"
  }],
  "service": [{
    "id": "did:qube:550e8400...#fio",
    "type": "FIOHandle",
    "serviceEndpoint": "https://fio-test.bloks.io/account/test21@knyt"
  }]
}
```

### Identity Layers in DIDQube

1. **Persona ID** = DID Subject (`did:qube:...`)
   - Local identifier
   - Application-specific
   - Can have multiple per user

2. **FIO Handle** = Alternative DID (`did:fio:...`)
   - Blockchain-based
   - Publicly verifiable
   - Portable across apps

3. **FIO Public Key** = Verification Method
   - Cryptographic proof
   - Controls blockchain identity
   - Signs transactions

---

## Example: Complete Identity Record

```typescript
{
  // System Layer
  id: "550e8400-e29b-41d4-a716-446655440000",
  root_id: null,
  app_origin: "aigent-z",
  created_at: "2025-10-22T20:00:00Z",
  
  // Blockchain Layer
  fio_handle: "test21@knyt",
  fio_public_key: "FIO7Jpu6RnKt6URTaQfXfdzZBFtoXdbXuQMiVPVyrM913ES6wzFvo",
  fio_tx_id: "a1b2c3d4e5f6...",  // Real blockchain transaction
  fio_registration_status: "confirmed",
  fio_registered_at: "2025-10-22T20:00:05Z",
  fio_handle_expiration: "2026-10-22T20:00:05Z",
  
  // Identity Settings
  default_identity_state: "semi_anonymous",
  world_id_status: "verified_human"
}
```

---

## How to Verify Each Layer

### 1. Verify Persona ID (Database)
```sql
SELECT * FROM persona WHERE id = '550e8400-e29b-41d4-a716-446655440000';
```

### 2. Verify FIO Handle (Blockchain)
```bash
# Via FIO Explorer
https://fio-test.bloks.io/account/test21@knyt

# Via API
curl -X POST https://testnet.fioprotocol.io/v1/chain/avail_check \
  -d '{"fio_name":"test21@knyt"}'
```

### 3. Verify FIO Public Key (Blockchain)
```bash
# Check balance
curl -X POST https://testnet.fioprotocol.io/v1/chain/get_fio_balance \
  -d '{"fio_public_key":"FIO7Jpu6..."}'

# Check FIO names owned
curl -X POST https://testnet.fioprotocol.io/v1/chain/get_fio_names \
  -d '{"fio_public_key":"FIO7Jpu6..."}'
```

---

## Summary Table

| Identifier | Type | Location | Searchable On | Purpose |
|------------|------|----------|---------------|---------|
| **Persona ID** | UUID | Database | ❌ FIO Explorer<br>✅ Your API | Internal reference |
| **FIO Handle** | String | Blockchain | ✅ FIO Explorer<br>✅ FIO API | User-facing identity |
| **FIO Public Key** | Crypto Key | Blockchain | ✅ FIO Explorer<br>✅ FIO API | Ownership proof |
| **Transaction ID** | Hash | Blockchain | ✅ FIO Explorer | Registration proof |

---

## Key Takeaways

1. **Persona ID** is your internal system identifier (like a user ID)
2. **FIO Handle** is the user's public blockchain identity
3. **FIO Public Key** is the cryptographic owner of the handle
4. They're all linked in your database but serve different purposes
5. Only FIO Handle and Public Key exist on the blockchain
6. Persona ID enables one user to have multiple blockchain identities

**Think of it like:**
- Persona ID = Your employee ID number
- FIO Handle = Your email address
- FIO Public Key = Your email password (but public)
