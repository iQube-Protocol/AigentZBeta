sequenceDiagram
  participant UI as External UI
  participant API as Aigent Z API
  participant ICP as ICP Bridge
  participant DB as Supabase
  participant BTC as Bitcoin Network

  UI->>API: POST /icp/mint { owner, meta }
  API->>ICP: mint_iQube(owner, meta)
  ICP-->>API: { proofId, status: accepted }
  API->>DB: INSERT iqubes (metaQubeRef, owner, status='minting')
  rect rgb(245,245,245)
    Note over ICP,BTC: ICP canister performs mint using chain-key BTC\nand emits on-chain tx (Ordinals/Runes as needed)
  end
  ICP-->>API: webhook/progress { proofId, btcTxId, status: active }
  API->>DB: UPDATE iqubes SET status='active', chain_tx=btcTxId
  API-->>UI: { id, status: active, chain_tx }
