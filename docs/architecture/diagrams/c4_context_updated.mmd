flowchart LR
  subgraph Users
    U[End User]
    Admin[Operator/Admin]
  end

  subgraph ExternalUI["External UI<br/>(provided by product owner)"]
    UI[Web App / Chat UI]
  end

  U --> UI
  Admin --> UI

  subgraph AigentZ["Aigent Z Beta Platform"]
    direction TB
    OG["Orchestration Layer<br/>Agent Runner · MCP Client · A2A Adapter"]
    CTX["Context Layer<br/>iQube Resolver · Policy Engine · Memory Manager"]
    SRV["Services Layer<br/>API Gateway · Identity/Payments · CrossChain(LayerZero) · ERC-8004 · FIO · Chain Clients"]
    ST["State Layer<br/>Supabase(Postgres+RLS) · Object Store · Audit/Telemetry"]
  end

  UI --> SRV
  SRV --> ST
  OG --> CTX
  CTX --> ST
  OG --> SRV

  subgraph Chains["Blockchains & Registries"]
    direction TB
    EVM["EVM Chains<br/>(ERC-8004, payments, token-gates)"]
    LZ["LayerZero OApp/OFT"]
    FIO["FIO Protocol (handles)"]
    REG["iQube Registry<br/>(metaQubes index)"]
    ICP["ICP / Bitcoin<br/>(dual-lock mint)"]
  end

  SRV --- EVM
  SRV --- FIO
  SRV --- LZ
  SRV --- REG
  SRV --- ICP

  SRV -- "read + write (tx submit, query)" --- EVM
  SRV -- "read + write (deliver/receive)" --- LZ
  SRV -- "read + write (canister calls, BTC via ICP)" --- ICP
